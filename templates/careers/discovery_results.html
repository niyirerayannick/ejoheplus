{% extends "base.html" %}

{% block title %}Career Discovery Results{% endblock %}

{% block extra_css %}
{% include "partials/home_styles.html" %}
<style>
.animate-fade-up {
    opacity: 0;
    transform: translateY(12px);
    animation: fade-up 0.7s ease-out forwards;
}
@keyframes fade-up {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>
{% endblock %}

{% block content %}
<section class="py-24 bg-gray-50">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between mb-4 border-b border-gray-200">
            <div class="flex items-center gap-2">
                <button type="button" data-tab-target="profile" class="px-4 py-3 text-sm font-semibold border-b-2 border-[#003d29] text-[#003d29]">
                    <i class="fas fa-chart-line mr-2"></i>Your profile
                </button>
                <button type="button" data-tab-target="riasec-info" class="px-4 py-3 text-sm font-semibold border-b-2 border-transparent text-gray-500 hover:text-[#003d29]">
                    <i class="fas fa-info-circle mr-2"></i>What is RIASEC?
                </button>
            </div>
            {% if level %}
            <div class="flex items-center gap-2 text-xs text-gray-500">
                <span class="font-semibold">Level:</span>
                <span class="course-pill draft">{{ level }}</span>
            </div>
            {% endif %}
        </div>

        <div id="tab-profile" data-tab-panel="profile">
            <div class="bg-white rounded-3xl shadow-2xl p-6 mb-8 animate-fade-up">
                <div class="flex flex-wrap items-center gap-3 mb-4">
                    <span class="text-xs text-gray-500 font-semibold">Your RIASEC code:</span>
                    <span class="course-pill active text-sm font-bold tracking-wide">{{ riasec_code }}</span>
                </div>

                <div class="relative h-64 mb-8">
                    <div class="absolute inset-0 grid grid-cols-6 gap-0 pointer-events-none">
                        <div class="bg-[#e8f5e9]/70"></div>
                        <div class="bg-[#e3f2fd]/70"></div>
                        <div class="bg-[#f3e5f5]/70"></div>
                        <div class="bg-[#fff3e0]/70"></div>
                        <div class="bg-[#ede7f6]/70"></div>
                        <div class="bg-[#e0f2f1]/70"></div>
                    </div>
                    <canvas id="riasecChart" class="relative z-10 w-full h-full"></canvas>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    {% for item in top_interest_cards %}
                    <button type="button"
                            class="w-full py-3 rounded-xl text-center text-sm font-bold text-gray-900 focus:outline-none bg-white/90 border border-transparent hover:border-[#003d29]/10 shadow-sm hover:shadow-md transition transform hover:-translate-y-0.5"
                            data-interest-code="{{ item.code }}"
                            data-interest-label="{{ item.label }}"
                            data-interest-explanation="{{ item.explanation }}">
                        {{ item.label }}
                    </button>
                    {% endfor %}
                </div>
                <div class="flex items-center justify-between text-xs text-gray-500">
                    <span>Click an interest to learn more</span>
                    <a href="#" id="share-profile" class="inline-flex items-center gap-1 text-[11px] font-semibold text-[#003d29] hover:text-[#ff9800] underline underline-offset-2">
                        <i class="fas fa-share-alt text-[11px]"></i>
                        <span>Save or share your profile</span>
                    </a>
                </div>
            </div>

            <div class="bg-white rounded-3xl shadow-md p-6 mb-6 animate-fade-up" style="animation-delay:0.1s;">
                <h2 class="text-lg font-semibold text-[#003d29] mb-4">Next, find a mentor for your career:</h2>
                <div class="flex flex-col md:flex-row items-center gap-4 mb-4">
                    <p class="text-sm text-gray-700 flex-1">Connect with mentors who understand your interests and can guide your next steps.</p>
                    <a href="/mentorship/mentors/" class="inline-flex items-center justify-center px-5 py-3 rounded-full border border-[#003d29] text-[#003d29] text-sm font-semibold hover:bg-[#003d29] hover:text-white transition">
                        Find a mentor for your career
                        <span class="ml-2"><i class="fas fa-arrow-right"></i></span>
                    </a>
                </div>
                <p class="text-sm text-gray-700 mb-3">Or skip ahead to explore all available courses:</p>
                <a href="/courses/" class="inline-flex items-center justify-center px-6 py-3 rounded-full bg-[#003d29] text-white text-sm font-semibold hover:bg-[#00543a] transition">
                    Explore courses
                    <span class="ml-2"><i class="fas fa-arrow-right"></i></span>
                </a>
            </div>

            <div class="bg-white rounded-3xl shadow-md p-6 animate-fade-up" style="animation-delay:0.18s;">
                <h3 class="text-lg font-semibold text-[#003d29] mb-3">Best career matches</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% for item in best_matches %}
                    <div class="course-card p-5">
                        <div class="flex items-center justify-between">
                            <h4 class="font-semibold text-gray-900 text-sm">{{ item.career.title }}</h4>
                            <span class="course-pill active text-xs">{{ item.percentage }}% Match</span>
                        </div>
                        <p class="text-xs text-gray-600 mt-2">{{ item.career.overview|truncatewords:24 }}</p>
                        <div class="mt-3">
                            <p class="text-[11px] text-gray-500 font-semibold mb-1">Why this fits you</p>
                            <ul class="text-[11px] text-gray-600 space-y-1">
                                {% for reason in item.reasons %}
                                <li><i class="fas fa-check-circle text-[#ff9800] mr-2"></i>{{ reason }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-sm text-gray-600">No matches available yet. Please contact support.</p>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div id="tab-riasec-info" data-tab-panel="riasec-info" class="hidden">
            <div class="bg-white rounded-3xl shadow-2xl p-6 mb-8">
                <p class="text-sm text-gray-700 mb-4">
                    The RIASEC vocational interest model is based on psychologist John Hollandâ€™s theory that people are more satisfied and successful when their work matches their interests and personality.
                    Six broad interest areas describe both individuals and work. Click an interest to learn more:
                </p>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                    <button type="button"
                            class="rounded-2xl p-4 text-center text-sm font-semibold text-gray-900 bg-[#e8f5e9] hover:shadow-md hover:-translate-y-0.5 transition transform"
                            data-interest-code="R"
                            data-interest-label="Realistic"
                            data-interest-explanation="You prefer practical, hands-on work with tools, objects, or the outdoors.">
                        Realistic
                    </button>
                    <button type="button"
                            class="rounded-2xl p-4 text-center text-sm font-semibold text-gray-900 bg-[#e3f2fd] hover:shadow-md hover:-translate-y-0.5 transition transform"
                            data-interest-code="I"
                            data-interest-label="Investigative"
                            data-interest-explanation="You enjoy understanding how things work through research, analysis, and problem solving.">
                        Investigative
                    </button>
                    <button type="button"
                            class="rounded-2xl p-4 text-center text-sm font-semibold text-gray-900 bg-[#f3e5f5] hover:shadow-md hover:-translate-y-0.5 transition transform"
                            data-interest-code="A"
                            data-interest-label="Artistic"
                            data-interest-explanation="You are drawn to creative expression through design, art, music, or writing.">
                        Artistic
                    </button>
                    <button type="button"
                            class="rounded-2xl p-4 text-center text-sm font-semibold text-gray-900 bg-[#fff3e0] hover:shadow-md hover:-translate-y-0.5 transition transform"
                            data-interest-code="S"
                            data-interest-label="Social"
                            data-interest-explanation="You like helping, teaching, or supporting others through direct interaction.">
                        Social
                    </button>
                    <button type="button"
                            class="rounded-2xl p-4 text-center text-sm font-semibold text-gray-900 bg-[#ede7f6] hover:shadow-md hover:-translate-y-0.5 transition transform"
                            data-interest-code="E"
                            data-interest-label="Enterprising"
                            data-interest-explanation="You enjoy leading, persuading, and taking initiative, especially in business settings.">
                        Enterprising
                    </button>
                    <button type="button"
                            class="rounded-2xl p-4 text-center text-sm font-semibold text-gray-900 bg-[#e0f2f1] hover:shadow-md hover:-translate-y-0.5 transition transform"
                            data-interest-code="C"
                            data-interest-label="Conventional"
                            data-interest-explanation="You prefer organized, detailed work with data, records, and clear procedures.">
                        Conventional
                    </button>
                </div>
                <p class="text-sm text-gray-700">
                    Careers that share a similar profile to your personal combination of interest areas are likely to fit you.
                    This match can help you choose a career path or jobs where you will feel more motivated, capable, engaged, and happy.
                </p>
            </div>
        </div>
    </div>

    <div id="interest-modal" class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg mx-4 p-6 relative">
            <button type="button" id="interest-modal-close" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
                <i class="fas fa-times"></i>
            </button>
            <div class="flex items-center gap-3 mb-4">
                <div id="interest-modal-icon" class="w-8 h-8 rounded-full flex items-center justify-center text-white">
                    <i class="fas fa-user"></i>
                </div>
                <h2 id="interest-modal-title" class="text-lg font-semibold text-gray-900"></h2>
            </div>
            <p id="interest-modal-intro" class="text-sm text-gray-700 mb-4"></p>
            <p class="text-sm font-semibold text-gray-800 mb-2">You might specifically be interested in:</p>
            <ul id="interest-modal-list" class="list-disc pl-5 text-sm text-gray-700 space-y-1"></ul>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    var tabs = document.querySelectorAll('[data-tab-target]');
    var panels = document.querySelectorAll('[data-tab-panel]');
    tabs.forEach(function (tab) {
        tab.addEventListener('click', function () {
            var target = tab.getAttribute('data-tab-target');
            tabs.forEach(function (t) {
                t.classList.remove('border-[#003d29]', 'text-[#003d29]');
                t.classList.add('border-transparent', 'text-gray-500');
            });
            tab.classList.add('border-[#003d29]', 'text-[#003d29]');
            tab.classList.remove('border-transparent', 'text-gray-500');
            panels.forEach(function (panel) {
                if (panel.getAttribute('data-tab-panel') === target) {
                    panel.classList.remove('hidden');
                } else {
                    panel.classList.add('hidden');
                }
            });
        });
    });

    var ctx = document.getElementById('riasecChart');
    if (ctx && window.Chart) {
        var riasecOrder = ['R', 'I', 'A', 'S', 'E', 'C'];
        var riasecScores = {
            {% for item in riasec_scores %}
            '{{ item.code }}': {{ item.score }}{% if not forloop.last %},{% endif %}
            {% endfor %}
        };
        var labels = riasecOrder;
        var data = riasecOrder.map(function (code) { return riasecScores[code] || 0; });
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    borderColor: '#1e88e5',
                    backgroundColor: 'rgba(30,136,229,0.1)',
                    pointBackgroundColor: '#ffffff',
                    pointBorderColor: '#1e88e5',
                    pointRadius: 5,
                    pointHoverRadius: 6,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: { enabled: true }
                },
                scales: {
                    x: {
                        grid: { display: false }
                    },
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(0,0,0,0.05)' },
                        ticks: { precision: 0 }
                    }
                }
            }
        });
    }

    var suggestions = {
        'R': ['Construction and repair', 'Engineering and mechanics', 'Agriculture and forestry', 'Technical trades'],
        'I': ['Science and research', 'Data analysis', 'Technology and computing', 'Medical investigation'],
        'A': ['Design and visual arts', 'Writing and media', 'Performing arts', 'Creative product development'],
        'S': ['Teaching and training', 'Counseling and coaching', 'Healthcare support', 'Community and social services'],
        'E': ['Business and entrepreneurship', 'Sales and marketing', 'Management and leadership', 'Public relations'],
        'C': ['Accounting and finance', 'Administration and office roles', 'Data management', 'Operations and logistics']
    };

    var colorMap = {
        'R': '#4caf50',
        'I': '#1e88e5',
        'A': '#8e24aa',
        'S': '#ffb300',
        'E': '#5e35b1',
        'C': '#00897b'
    };

    var interestButtons = document.querySelectorAll('[data-interest-code]');
    var modal = document.getElementById('interest-modal');
    var modalTitle = document.getElementById('interest-modal-title');
    var modalIntro = document.getElementById('interest-modal-intro');
    var modalList = document.getElementById('interest-modal-list');
    var modalIcon = document.getElementById('interest-modal-icon');
    var modalClose = document.getElementById('interest-modal-close');

    function openModal(code, label, explanation) {
        modalTitle.textContent = label;
        modalIntro.textContent = explanation || '';
        modalList.innerHTML = '';
        (suggestions[code] || []).forEach(function (item) {
            var li = document.createElement('li');
            li.textContent = item;
            modalList.appendChild(li);
        });
        var color = colorMap[code] || '#003d29';
        modalIcon.style.backgroundColor = color;
        modal.classList.remove('hidden');
    }

    interestButtons.forEach(function (btn) {
        btn.addEventListener('click', function () {
            var code = btn.getAttribute('data-interest-code');
            var label = btn.getAttribute('data-interest-label');
            var explanation = btn.getAttribute('data-interest-explanation');
            openModal(code, label, explanation);
        });
    });

    if (modalClose) {
        modalClose.addEventListener('click', function () {
            modal.classList.add('hidden');
        });
    }
    if (modal) {
        modal.addEventListener('click', function (e) {
            if (e.target === modal) {
                modal.classList.add('hidden');
            }
        });
    }

    var shareLink = document.getElementById('share-profile');
    function showToast(message) {
        var existing = document.getElementById('profile-toast');
        if (existing) {
            existing.remove();
        }
        var toast = document.createElement('div');
        toast.id = 'profile-toast';
        toast.className = 'fixed bottom-6 right-6 bg-[#003d29] text-white text-xs px-4 py-2 rounded-full shadow-lg z-50 opacity-0 transition-opacity';
        toast.textContent = message;
        document.body.appendChild(toast);
        requestAnimationFrame(function () {
            toast.classList.remove('opacity-0');
            toast.classList.add('opacity-100');
        });
        setTimeout(function () {
            toast.classList.remove('opacity-100');
            toast.classList.add('opacity-0');
            setTimeout(function () {
                toast.remove();
            }, 300);
        }, 2500);
    }

    if (shareLink) {
        shareLink.addEventListener('click', function (e) {
            e.preventDefault();
            var shareUrl = window.location.href;
            var shareText = 'My career interest profile (RIASEC: {{ riasec_code }}) from EjoHePlus';
            if (navigator.share) {
                navigator.share({
                    title: 'My Career Profile',
                    text: shareText,
                    url: shareUrl
                }).catch(function () {});
            } else if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(shareUrl).then(function () {
                    showToast('Profile link copied to clipboard');
                }).catch(function () {
                    alert('Profile link: ' + shareUrl);
                });
            } else {
                alert('Profile link: ' + shareUrl);
            }
        });
    }
});
</script>
{% endblock %}
